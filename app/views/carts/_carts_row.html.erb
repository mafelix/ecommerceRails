<h1>Shopping Cart</h1>

<div class="shopping-cart">
  <div class="column-labels">
    <label class="product-image">Image</label>
    <label class="product-details">Product</label>
    <label class="product-price">Price</label>
    <label class="product-quantity">Quantity</label>

    <!-- adding update column to labels -->
    <label class="product-update">Update</label>
    <label class="product-removal">Remove</label>
    <label class="product-line-price">Total</label>
  </div>

  <%if @cart.cart_items.size == 0%>
  <div class="text-center">
    <p>Looks like you have nothing in your cart! <%=link_to 'Add something to your cart', products_path%></p>
  </div>
  <%end%>

  <br />
  <br />
  <%if @cart_items != nil%>
    <%@cart_items.each do |item|%>

    <div class="product">
      <div class="product-image">
        <%=image_tag(item.product.picture)%>
      </div>
      <div class="product-details">
        <div class="product-title"><%=item.product.name%></div>
        <p class="product-description"><%=item.product.description%></p>
      </div>
      <div class="product-price"><%=number_to_currency(item.product.price)%></div>

      <%=form_for item, remote: true do |f|%>
      <div class="product-quantity">
        <%=f.number_field :quantity, value: item.quantity, min: 1, max: 8%>
        <%=f.hidden_field :product_id, value: item.product.id%>
        <!-- <input type="number" value="<%=item.quantity%>" min="1" max="8"> -->
      </div>
      <div class="product-update">
        <%=f.submit 'Update', class: "update-product"%>
        <!-- <%=f.hidden_field :product_id, value: item.product.id%> -->
        <!-- <button class="update-product">
          Update
        </button> -->
      </div>
      <div class="product-removal">
        <%= link_to "Remove", item, {data: {confirm: "Are you sure you wish to delete the product '#{item.product.name}' from your cart?"}, method: :delete, remote: true, class: "remove-product"}%>
        <!-- <button class="remove-product">
          Remove
        </button> -->
        <%end%>
      </div>
      <div class="product-line-price"><%=number_to_currency(item.product.price*item.quantity)%></div>
    </div>
  <%end%>
  <%end%>
<br />
<br />
<!--Temporary solution until model methods are written  -->
<% if @cart_items != nil%>
  <!--subtotal variable -->
  <%subtotal =@cart_items.collect {|item| item.quantity*item.unit_price}.sum%>
  <!--subtotal + shipping cost  -->
  <%total=subtotal+15%>
<%end%>
<div class="totals">
  <div class="totals-item">
    <label>Subtotal</label>
    <div class="totals-value" id="cart-subtotal"><%=subtotal%></div>
  </div>
  <div class="totals-item">
    <label>Tax (5%)</label>
    <div class="totals-value" id="cart-tax">Included!</div>
  </div>
  <div class="totals-item">
    <label>Shipping</label>
    <div class="totals-value" id="cart-shipping">15.00</div>
  </div>
  <div class="totals-item totals-item-total">
    <label>Grand Total</label>
    <div class="totals-value" id="cart-total">
      <%=total%>
    </div></div>
  </div>
</div>
<div class="checkout-btn">
  <button class="checkout">Checkout</button>
</div>
</div>
