<h1>Shopping Cart</h1>

<div class="shopping-cart">
  <div class="column-labels">
    <label class="product-image">Image</label>
    <label class="product-details">Product</label>
    <label class="product-price">Price</label>
    <label class="product-quantity">Quantity</label>

    <!-- adding update column to labels -->
    <label class="product-update">Update</label>
    <label class="product-removal">Remove</label>
    <label class="product-line-price">Total</label>
  </div>

  <br />
  <br />
  <br />
  <%if @cart.cart_items.size == 0%>
  <div class="text-center">
    <p>Looks like you have nothing in your cart! <%=link_to 'Add something to your cart', products_path%></p>
  </div>
  <%end%>

  <br />
  <br />
  <%if !@cart_items.empty? %>
    <%@cart_items.each do |item|%>

    <div class="product">
      <div class="product-image">
        <%=image_tag(item.product.picture)%>
      </div>
      <div class="product-details">
        <div class="product-title"><%=item.product.name%></div>
        <p class="product-description"><%=item.product.description%></p>
      </div>
      <div class="product-price"><%=number_to_currency(item.product.price)%></div>

      <%=form_for item, remote: true do |f|%>
      <div class="product-quantity">
        <%=f.number_field :quantity, value: item.quantity, min: 1, max: 8%>
        <%=f.hidden_field :product_id, value: item.product.id%>
      </div>
      <div class="product-update">
        <%=f.submit 'Update', class: "update-product"%>
      </div>
      <%end%>
      <div class="product-removal">
        <%= button_to "Remove", item, {data: {confirm: "Are you sure you wish to remove '#{item.product.name}' from your cart?"}, method: :delete, remote: true, class: "remove-product"}%>
      </div>
      <div class="product-line-price"><%=number_to_currency(item.product.price*item.quantity)%></div>
    </div>
  <%end%>
  <%end%>
<br />
<br />

<!--Temporary solution until model methods are written  -->
<% if !@cart_items.empty? %>
  <!--subtotal variable -->
  <%subtotal =@cart_items.collect {|item| item.quantity*item.unit_price}.sum%>
  <!--subtotal + shipping cost  -->
  <%total=subtotal+15%>
<div class="totals">
  <div class="totals-item">
    <label>Subtotal</label>
    <div class="totals-value" id="cart-subtotal"><%=subtotal%></div>
  </div>
  <div class="totals-item">
    <label>Tax (5%)</label>
    <div class="totals-value" id="cart-tax">Included!</div>
  </div>
  <div class="totals-item">
    <label>Shipping</label>
    <div class="totals-value" id="cart-shipping">15.00</div>
  </div>
  <div class="totals-item totals-item-total">
    <label>Grand Total</label>
    <div class="totals-value" id="cart-total">
      <%=total%>
    </div></div>
  </div>
</div>
<!-- <div class="container">
  <div class="row">
      <div class="col-md-6">
        <%=@user.address %><%= Time.zone.now.strftime("%d/%m/%Y %H%M") %>
      </div>
  </div>
</div> -->
<div class="checkout-btn">
  <button class="checkout" data-toggle="modal" data-target="#checkout-modal">Checkout</button>
</div>

<div class="modal fade" id="checkout-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Checkout Summary</h4>
      </div>
      <div class="modal-body">
        <p>
          <%=Faker::Lorem.paragraph(15)%>
        </p>
      </div>
      <div class="modal-footer">
        Copyright Platinum Herbal Society
      </div>
    </div>
  </div>
</div>

</div>
<%end%>
